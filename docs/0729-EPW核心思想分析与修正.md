专家路径水印的批判性分析与增强框架

* * *

第1章：专家路径水印（EPW）框架

为了对后续的批判性分析建立坚实的基础，本章旨在对原始文献中定义的专家路径水印（EPW）框架进行全面而精确的阐述。

### 1.1 基础原则：从基于词元的播种到基于路径的播种

专家路径水印（EPW）框架的核心创新在于，它将水印伪随机种子的来源，从一个局部的、表层级的特征——即前一个词元 xt−1​ 的哈希值——迁移到了一个深层的、模型内部的特征：即“门控状态”（Gating State）St​ 1。

这一转变代表了水印设计范式的根本性变革。以Kirchenbauer等人（KGW）为代表的传统方案，其安全性依赖于一个与模型语义理解关联较弱的哈希函数 1。这种设计使其在面对能够保留语义但改变局部词元选择的攻击（如转述攻击）时显得相对脆弱。EPW框架则提出一个核心假设：门控状态

St​，即模型在特定上下文下决定将当前词元路由至哪个或哪些专家的决策过程，其本身就与文本的深层语义上下文紧密相连。这种“语义接地”（Semantic Grounding）是EPW宣称其具有更高鲁棒性的理论基石 1。

门控状态 St​ 的定义可以具有不同层次的复杂性，以捕捉不同粒度的路由信息：

* **顶级专家索引（Top-1 Expert Index）**：最简单的定义，即使用被选中的得分最高的专家索引 et(1)​。
  
* **专家组元组（Top-K Expert Tuple）**：使用所有被选中的Top-K专家的索引元组 (et(1)​,et(2)​,…,et(K)​)，以捕捉更丰富的信息。
  
* **路径哈希（Path Hashing）**：为了使水印具有历史依赖性，可以递归地定义门控状态，将当前步骤的专家选择与前一步的状态结合起来，例如 $S_t = \text{hash}(S_{t-1} |
  

| e_t^{(1)})$，其中 ∣∣ 表示串联。这种方式将整个专家激活序列编码成一个不断演变的“路径”签名。

### 1.2 算法变体I：门控播种绿名单（GSG）

门控播种绿名单（Gating-Seeded Green-Listing, GSG）是EPW框架最直接的实现。它仅替换了KGW方案的播种机制，而保留了其经典的绿红名单划分和固定的logits修改逻辑 1。

**算法逻辑：**

1. **前向计算与路由**：在自回归生成的第 t 步，模型根据当前上下文计算出隐藏状态 ht​，并将其送入MoE层的路由器。
  
2. **专家选择**：路由器根据其Top-K策略选择专家，并识别出得分最高的Top-1专家索引 et​。
  
3. 种子生成：使用一个带密钥的伪随机函数（PRF），结合保密的 secret_key 和当前专家索引 et​ 来生成一个确定性的种子。seedt​=PRF(secret_key,et​)
  
4. **词汇表划分**：利用 `seed_t`，将整个词汇表 V 确定性地划分为绿名单 Gt​ 和红名单 Rt​。
  
5. Logits修改：对于绿名单 Gt​ 中的所有词元 v，其logit值增加一个固定的正值 δ。logit′(v)=logit(v)+δ,∀v∈Gt​
  
6. **词元采样**：从修改后的logits分布中采样生成下一个词元 xt​。
  

GSG作为EPW概念的基准实现，其主要贡献在于将水印信号与模型的专家选择行为绑定，从而将水印的安全性从破解一个公开的哈希函数，提升到了预测一个由数十亿参数决定的、高度非线性的路由决策的难度。

### 1.3 算法变体II：专家特异性加权扰动（EWP）

专家特异性加权扰动（Expert-Specific Weighted Perturbation, EWP）是一个更精巧的变体，它引入了两个层面的动态自适应能力：专家特异性的基础强度 δi​ 和基于路由置信度的实时调制 1。

**算法逻辑：**

1. 前向计算与路由、专家选择与GSG相同，但除了记录Top-1专家索引 et​ 外，还需保留路由器输出的完整Softmax概率分布 pt​(e)。
  
2. 动态水印强度计算：EWP不再使用全局固定的 δ。取而代之的是，它为每个专家 ei​ 预设一个基础水印强度 δi​。然后，根据当前路由决策的置信度（即Top-1专家的Softmax概率）来动态计算有效水印强度 δeff​：δeff​=pt​(et​)δet​​​其中 et​ 是当前步选择的Top-1专家。
  
3. 后续的种子生成、词汇表划分和logits修改过程与GSG相同，但使用动态计算出的 δeff​ 代替固定的 δ。
  

EWP的设计体现了对MoE训练动态更深刻的理解。它利用了MoE模型中为维持系统稳定而引入的负载均衡辅助损失（auxiliary load-balancing loss）所带来的“非自然”决策 1。当路由器在其主要优化目标（最小化困惑度）和辅助目标（均衡负载）之间博弈时，可能会以较低的置信度

pt​(et​) 选择一个并非最优但使用率较低的专家。根据EWP的公式，正是在这些模型行为最独特、最难以被外部模仿的“犹豫”时刻，水印信号被显著放大。而在模型高置信度、高质量生成文本时，水印信号则被减弱，从而最大限度地保护了文本质量。这种风险自适应策略使得水印在模型最独特的行为模式上留下最强的印记。

### 1.4 提议的检测机制：重构专家路径

EPW的检测机制是其设计中的一个关键环节，同时也是其主要的实践瓶颈。检测器需要“灰盒”（gray-box）访问权限，即能够观察到模型内部的路由决策 1。

**检测流程：**

1. 检测器将待测文本逐词元地输入到被怀疑的模型中。
  
2. 在每一步 t，通过一次前向传播，观察并记录模型为生成当前词元 xt​ 所选择的专家索引 et​。
  
3. 使用已知的 `secret_key` 和观察到的 et​，通过与生成时完全相同的算法重建出该步骤的绿名单 Gt​。
  
4. 统计实际词元 xt​ 落入重建的绿名单 Gt​ 中的次数。
  
5. 最后，通过计算Z-score等统计量，判断落入绿名单的词元总数是否显著高于在无水印文本中的期望值（即 L×γ，其中 L 是文本长度，γ 是绿名单比例）。
  

这一机制最显著的后果是其高昂的计算成本：检测一段长度为 L 的文本需要进行 L 次模型的前向传播。更重要的是，对模型内部状态的访问需求，从根本上限制了EPW在纯黑盒、仅提供API访问的场景中的直接适用性，而这类场景是当前LLM部署的主流模式之一 3。

* * *

第2章：核心假设的批判性审视

EPW框架的有效性建立在一系列关于MoE模型行为的强大假设之上。本章旨在通过更广泛的MoE架构和微调技术研究，对这些核心假设的合理性与局限性进行严格的审视。

### 2.1 专家路由的不可预测性：一把双刃剑

EPW的核心安全假设是：专家激活路径是模型独有的、高熵的“指纹”，攻击者在没有原始模型的情况下，通过计算无法有效复现这一路径 1。然而，这一假设在现实中可能过于理想化。

首先，**路由机制本身可能并不如想象中复杂**。当前多数MoE实现采用的是一个简单的线性投影层后接Softmax函数来计算路由概率 4。这种设计虽然高效，但其捕捉输入与专家特化之间复杂关系的能力有限。研究人员正在探索更具表达能力的路由器，如多层感知机（MLP）或基于注意力（Attention）的路由器，但这些结构化的设计也可能使其行为模式更易于被分析和预测 4。此外，像哈希路由这样的确定性、无参数的替代方案，一旦其哈希函数被知晓，其路由行为将是完全透明的 5。

其次，**负载均衡机制在某种程度上会增强路由的可预测性**。负载均衡辅助损失函数的目标是惩罚不均衡的专家分配，它会主动迫使路由器的决策趋向于均匀分布，从而降低其对输入内容的敏感度 2。尽管EPW巧妙地利用了这种机制导致的“非自然”选择，但一个了解此通用机制的攻击者，也可能在其攻击模型中模拟这种均衡行为。研究表明，若移除负载均衡，路由会迅速“坍塌”至少数几个“热门”专家，这反而揭示了模型在没有外部约束时存在强烈的、可预测的内在偏好 1。

最后，**专家特化本身也可能泄露路由信息**。MoE架构的目标就是让不同专家处理不同类型的数据或任务 8。如果一个专家特化于处理Python代码，而另一个专家精通法律文书，那么对于一个给定的代码片段，其路由选择将变得高度可预测。攻击者可以通过分析模型的大量输出来绘制“专家特化地图”，从而大大降低复现专家路径的难度。

综合来看，EPW的安全性与MoE模型的架构特性之间存在一种内在的张力。EPW所依赖的路由行为的“独特性”和“不可预测性”，在很大程度上源于当前MoE架构尚不完美的训练动态和路由机制。然而，MoE领域的研究方向正是要通过改进路由算法和专家特化训练，来消除路由过程中的不确定性和低效性，使其更加稳定和可解释 7。这意味着，

**EPW的安全性可能与底层MoE架构的成熟度成反比**。随着MoE模型变得越来越优化，其路由行为越来越“理性”，EPW赖以生存的“高熵信号源”可能会逐渐枯竭。

### 2.2 路由在参数高效微调（PEFT）攻击下的稳定性

EPW对微调攻击的鲁棒性，建立在另一个关键假设上：参数高效微调（PEFT）方法（如LoRA）通常会冻结路由器参数，仅训练插入在专家网络内部的适配器，因此核心的路由行为会保持不变 1。这一假设在几年前或许成立，但如今已显得过于简单，甚至与当前的研究前沿相悖。

一个庞大且活跃的研究领域正致力于**将PEFT与MoE进行深度协同融合**，而非简单叠加。在许多先进的框架中，LoRA适配器本身就被用作“专家”，并专门训练一个路由器来动态选择激活哪个适配器 10。

更有甚者，一些研究工作明确指出，**简单地重用预训练模型的路由器在微调时会导致性能不佳或训练不稳定**，因此提出直接对路由机制本身进行微调。例如，“路由器混合”（Mixture of Routers, MoR）方法通过引入多个子路由器来提升决策的鲁棒性；而基于图神经网络（GNN）的路由器则旨在学习专家之间的协作关系，从而进行更智能的路由 10。

此外，像TT-LoRA MoE这样的框架采用了**解耦的训练策略**：先独立训练好各个专家（适配器），然后在一个冻结了专家和基础模型的阶段，单独训练一个轻量级的路由器 18。攻击者完全可以利用这类技术，在保留原模型专家网络的同时，用一个全新的、由自己控制的路由逻辑来替换掉原始的路由机制，从而彻底绕开EPW水印。

这些进展揭示了EPW设计中的一个深层矛盾。EPW为了保证其在微调后的可检测性，要求路由机制保持静态。然而，当前最高效、最先进的MoE模型自适应方法，恰恰需要对路由机制进行修改和优化 10。这对一个合法的模型所有者构成了困境：一旦为基础模型部署了EPW水印，他们在后续的微调和适配中将被迫放弃那些可能带来更佳性能的、涉及路由修改的先进PEFT技术，仅仅为了维持水印的有效性。因此，

**EPW不仅是为模型打上烙印，更是在其未来的演进和应用上施加了一道沉重的架构枷锁**，这大大降低了它在需要持续迭代和适应的动态场景中的吸引力。

### 2.3 “语义接地”假设：专家路径是真正的语义签名吗？

EPW框架声称其鲁棒性源于专家路径与文本的“深层语义理解”相绑定 1。然而，这种“语义接地”的程度值得商榷。

首先，路由器的决策并非纯粹的语义分析，而是一个**经过学习的、服务于混合目标的启发式策略**。路由器的优化目标是最小化一个联合损失函数，该函数通常包括模型的预测损失（如交叉熵）和负载均衡损失 1。因此，它的决策是在“追求性能”和“维持系统稳定”两种力量之间权衡的结果，是一种学到的启发式规则，而非对语义的纯粹表达。两个对同一段文本具有相同语义理解的模型，可能因为不同的初始化参数或训练数据顺序，而学习到完全不同的路由启发式策略。

其次，**专家的功能重叠会削弱路由选择的语义意义**。负载均衡的压力往往会导致不同专家接收到高度重叠的训练数据（词元分布），从而使其功能特化变得模糊 7。如果多个专家都能处理相似类型的输入，那么在它们之间进行选择的决策，其语义区分度就会大大降低。事实上，当前有研究正致力于引入正交性损失等手段，来强制增强专家的特化程度，这本身就说明了在标准训练下，专家特化并非一个理想的、自然达成的状态 7。

因此，专家路径更应被视为一个**与语义高度相关的架构伪像（architectural artifact）**，而非语义本身。它由输入词元的隐藏状态和路由器的权重矩阵共同决定。虽然它与语义相关，但并不等同于语义。一个攻击者可能通过对隐藏状态施加微小的、非语义的扰动，就足以改变路由决策，从而破坏水印，而文本的宏观意义却不受影响。

更进一步，EWP变体的自适应增强机制，恰恰依赖于模型路由决策中的不完美之处——即由负载均衡压力等因素导致的低置信度、“非自然”的路由选择 1。然而，MoE模型优化的一个重要方向，就是通过改进路由器设计、增强专家特化和采用更先进的负载均衡策略，来

**消除这些低效或不确定的路由决策** 2。例如，旨在增强“专家-路由协同作用”的方法，其目标之一就是提升路由得分的方差，这意味着更高、更明确的路由置信度，从而减少低置信度决策的发生 7。因此，EWP的有效性悖论般地建立在模型的“缺陷”之上。随着MoE模型变得越来越高效，路由决策越来越果断，EWP能够施加强信号的机会将越来越少，这可能会系统性地削弱整个水印的鲁棒性。

* * *

第3章：已识别的缺陷与提议的增强方案

从批判转向构建，本章针对EPW框架中识别出的三大核心缺陷——灰盒访问依赖、对高级PEFT攻击的脆弱性以及高昂的检测成本——提出具体的、有理论依据的增强方案。

### 3.1 灰盒约束：一个概率性黑盒检测框架

**缺陷**：EPW的检测机制要求灰盒访问权限，这使其无法应用于广大的纯黑盒API模型 1。

**提议的解决方案：概率性专家路径推断（Probabilistic Expert Path Inference, PEPI）**

**核心思想**：利用一个基本事实——由于功能特化，不同的专家在生成下一个词元时，会产生统计上可区分的概率分布（即logits）。通过分析黑盒模型返回的输出logits，我们可以反向推断出最有可能被激活的专家。

**理论依据**：研究表明，采用不同路由策略的MoE模型，其输出分布存在显著差异 22。而旨在增强专家特化程度的研究，如引入正交性损失，将使不同专家的输出分布更具区分性，从而为PEPI的成功提供了更强的理论支持 7。

**方法论**：

1. 离线分析（由水印提供方执行）：a. 对于一个已加水印的MoE模型，生成一个大规模的文本语料库。b. 在生成每个词元时，同时记录被激活的真实专家索引 ei​ 和模型最终输出的logits向量 li​。c. 训练一个轻量级的分类模型，我们称之为“路径推断预言机”（Path-Inference Oracle）。该预言机以一个logits向量 l 作为输入，输出一个关于所有专家的概率分布 P(e∣l)，即预测该logits是由哪个专家主导生成的。这个预言机实质上是学习了每个专家的“logits指纹”。
  
2. 在线黑盒检测：a. 对于一段待测文本，通过自回归方式调用黑盒模型的API，获取每个位置的下一词元输出logits向量。b. 对于每个词元 xt​ 及其对应的logits lt​，使用“路径推断预言机”来预测最有可能的专家：e^t​=argmaxe​P(e∣lt​)。c. 使用这条概率性推断出的专家路径 (e^1​,e^2​,…) 作为输入，运行标准的EPW检测算法（即重建绿名单并计算Z-score）。
  

这一方法将水印检测问题转化为了一个模式识别问题。更重要的是，它形成了一个**自验证系统**。PEPI预言机的推断并非百分之百准确，但EPW水印检测本身就是一个统计过程，它不需要完美无瑕的路径重建，只需要重建的路径与真实路径的相关性显著高于随机猜测即可。Z-score的计算结果本身就提供了置信度度量。如果推断出的路径虽然有噪声，但保留了足够多的真实信号，Z-score依然会很高，从而确认水印的存在。反之，如果文本来自一个完全不同的模型，推断出的路径将接近随机噪声，Z-score会很低。因此，一个高Z-score的检测结果，不仅验证了水印的存在，也间接验证了路径推断的有效性。

### 3.2 增强对高级PEFT的鲁棒性：一个感知路由器状态的协议

**缺陷**：EPW对那些会修改路由器的PEFT攻击非常脆弱，因为其水印信号与一个特定的、静态的路由器状态绑定 10。

**提议的解决方案：初始路由器状态哈希（Initial Router State Hashing, IRSH）**

**核心思想**：在水印生成过程中，不仅仅依赖于一个外部的秘密密钥，而是将**路由器参数初始状态的密码学哈希值**也嵌入到种子生成逻辑中。这使得水印与路由器的特定“版本”深度绑定。

**方法论**：

1. 水印生成：a. 在为模型添加水印时，计算其路由器权重矩阵的密码学哈希值：router_hash=hash(Wrouter_initial​)。b. 修改GSG/EWP的种子生成公式，将此哈希值包含在内：seedt​=PRF(secret_key,et​,router_hash)secret_key 仍然是必要的，以防止知道router_hash的攻击者伪造水印。
  
2. 水印检测：a. 检测器必须同时拥有 secret_key 和原始的 router_hash。b. 使用这三个组件（密钥、专家索引、路由器哈希）来重建绿名单并进行统计检验。
  

影响：

通过这一增强，如果攻击者使用某种PEFT技术修改了路由器的权重，他们将无法生成带有有效水印信号的文本，因为他们不知道 secret_key。他们生成的任何文本在检测时都会失败，因为检测器使用的是原始的 router_hash，而这个哈希值与被修改后的模型的路由行为不再匹配。这种情况下，水印并非被“移除”，而是因模型被篡改而“失效”。这成功地将一种移除攻击转化为一种可被检测到的模型篡改行为，从而保护了水印的完整性。

### 3.3 缓解高昂的检测成本：一种分层抽样方法

**缺陷**：EPW检测需要对长度为 L 的文本进行 L 次模型前向传播，计算成本过高，不适用于大规模检测 1。

**提议的解决方案：置信度分层路径验证（Confidence-Stratified Path Verification, CSPV）**

**核心思想**：并非所有词元的路由决策都具有同等的法证价值。与其检查每一个词元，不如战略性地抽样那些路由决策最独特、最难被攻击者复制的词元进行验证。

**理论依据**：EWP变体的设计本身就基于一个洞察：低置信度的路由决策是模型最独特的信号源 1。我们可以将这一原则应用于检测阶段，以实现效率的提升。

**方法论（灰盒场景）**：

1. 对整段待测文本进行**单次**完整的前向传播，获取每个词元位置 t 的路由器输出Softmax概率分布 pt​(e)。
  
2. 不检查全部 L 个词元，而是根据一个分层策略选择一个小子集 S 进行重点验证：
  
  * **低置信度层**：抽取 k1​ 个路由器置信度 pt​(et​) 最低的词元（即模型最“犹豫”的地方）。
    
  * **高置信度层**：抽取 k2​ 个置信度最高的词元。
    
  * **随机层**：随机抽取 k3​ 个词元作为对照组。
    
3. **仅对**这个抽样出的子集 S 中的词元，执行昂贵的、逐词元的路径重建和验证。
  
4. 基于这个更小的样本量 ∣S∣=k1​+k2​+k3​，计算Z-score，将其中的绿名单命中数与期望值 γ×∣S∣ 进行比较。
  

通过这种方式，昂贵的前向传播次数从 L 次锐减到 ∣S∣ 次（其中 ∣S∣≪L），同时将检测算力集中在信息量最大的文本部分。其代价是，更短的文本样本需要更强的信号才能达到统计显著性，但这在效率和精度之间提供了一个灵活的权衡。

* * *

第4章：增强框架EPW-A的形式化定义

本章将前述提议的增强方案（IRSH, CSPV, PEPI）整合为一个统一、连贯的框架，即“增强型专家路径水印”（EPW-A），并使用伪代码对其核心算法进行形式化定义。

### 4.1 EPW-A 生成算法

EPW-A的生成算法在原始EPW的基础上，融入了**初始路由器状态哈希（IRSH）**协议，以增强其对模型修改的抵抗力。

Code snippet function EPW_A_Generate(model, text_prefix, length, secret_key, delta_config): # 1. 初始化 W_router = model.get_router_weights() router_hash = HASH(W_router) generated_text = text_prefix context = text_prefix # 2. 自回归生成 for t in 1..length: # a. 获取路由信息 hidden_state = model.get_hidden_state(context) router_output = model.route(hidden_state) top_expert_index = router_output.get_top_expert_index() expert_probabilities = router_output.get_softmax_probs() # b. 计算种子 (融入IRSH) seed = PRF(secret_key, top_expert_index, router_hash) # c. 划分绿红名单 green_list = get_green_list(seed, model.vocabulary) # d. 计算水印强度 (支持EWP) if delta_config.is_ewp: base_delta = delta_config.get_delta_for_expert(top_expert_index) confidence = expert_probabilities[top_expert_index] effective_delta = base_delta / confidence else: # GSG effective_delta = delta_config.get_global_delta() # e. 修改Logits original_logits = model.get_logits(hidden_state) modified_logits = original_logits.copy() for token_id in green_list: modified_logits[token_id] += effective_delta # f. 采样并更新上下文 next_token = sample_from_logits(modified_logits) generated_text.append(next_token) context.append(next_token) return generated_text

### 4.2 EPW-A 检测套件

EPW-A的检测套件包含两个核心组件：一个高效的灰盒检测器和一个创新的概率性黑盒检测器。

#### 4.2.1 灰盒检测器 (含CSPV)

该检测器利用**置信度分层路径验证（CSPV）**来降低计算成本。

Code snippet function EPW_A_Detect_Graybox(model, text, secret_key, router_hash, sample_size): # 1. 单次前向传播获取所有路由置信度 all_confidences = for t in 1..length(text): context = text[1..t-1] hidden_state = model.get_hidden_state(context) router_output = model.route(hidden_state) all_confidences.append(router_output.get_top_expert_confidence()) # 2. 置信度分层抽样 (CSPV) # 从all_confidences中选择最低、最高和随机的索引子集 sampled_indices = stratify_and_sample(all_confidences, sample_size) # 3. 对抽样点进行逐一验证 green_token_count = 0 for t in sampled_indices: # a. 重建专家路径 context = text[1..t-1] hidden_state = model.get_hidden_state(context) top_expert_index = model.route(hidden_state).get_top_expert_index() # b. 重建绿名单 (融入IRSH) seed = PRF(secret_key, top_expert_index, router_hash) green_list = get_green_list(seed, model.vocabulary) # c. 统计命中 if text[t] in green_list: green_token_count += 1 # 4. 计算Z-score z_score = calculate_z_score(green_token_count, sample_size, gamma) return z_score

#### 4.2.2 概率性黑盒检测器 (PEPI)

该检测器利用一个离线训练的“预言机”来推断黑盒模型的专家路径。

Code snippet # ---- 离线训练 ---- function Train_Path_Inference_Oracle(watermarked_model, training_corpus): X_logits, Y_experts =, for text in training_corpus: #... 生成文本，同时记录每一步的 (logits, expert_index) 对... X_logits.append(logits) Y_experts.append(expert_index) oracle = Classifier() oracle.train(X_logits, Y_experts) return oracle # ---- 在线检测 ---- function EPW_A_Detect_Blackbox(api, oracle, text, secret_key, router_hash): green_token_count = 0 for t in 1..length(text): # a. 从黑盒API获取Logits context = text[1..t-1] logits = api.get_logits(context) # b. 使用预言机推断专家路径 (PEPI) predicted_expert_index = oracle.predict(logits) # c. 重建绿名单 (融入IRSH) seed = PRF(secret_key, predicted_expert_index, router_hash) green_list = get_green_list(seed, api.vocabulary) # d. 统计命中 if text[t] in green_list: green_token_count += 1 # 4. 计算Z-score z_score = calculate_z_score(green_token_count, length(text), gamma) return z_score

* * *

第5章：更广泛的影响与未来研究轨迹

EPW-A框架不仅为LLM水印提供了一套更稳健的技术方案，其核心理念和技术挑战也对AI安全、模型可解释性及推理优化等领域产生了深远影响。

### 5.1 对比分析：EPW-A在水印技术版图中的定位

为了清晰地定位EPW-A的价值，下表将其与现有主流水印方案进行了多维度对比。

| 指标/维度 | KGW (基准) 1 | SynthID-Text 1 | EPW-EWP (原始) | **EPW-A (PEPI 检测)** |
| --- | --- | --- | --- | --- |
| **核心机制** | 基于前一词元哈希的Logits偏移 | 潜在空间扰动 | 基于专家选择和路由置信度的动态Logits偏移 | 基于专家选择和路由置信度的动态Logits偏移 (含IRSH) |
| **抗转述鲁棒性** | 中等  | 中等  | 非常高 | 非常高 |
| **抗PEFT鲁棒性** | 低   | 未知  | 低 (对路由修改) | **高 (通过IRSH)** |
| **安全性 (不可伪造性)** | 中等 (依赖短密钥) | 高 (依赖专有模型) | 非常高 (依赖模型架构) | **极高 (依赖模型架构+版本)** |
| **生成开销** | 极低  | 低   | 极低  | 极低  |
| **检测开销** | 极低  | 低 (API调用) | **高** | **中等 (概率性)** |
| **所需检测访问权限** | 公开密钥 | 专有黑盒API | **灰盒 (路由路径)** | **黑盒 (Logits)** |
| **对模型演进的约束** | 无   | 无   | **高** | **低 (通过IRSH)** |

此表清晰地揭示了EPW-A的战略定位。原始的EPW方案为了追求极致的鲁棒性和安全性，在检测成本和对模型演进的约束上付出了巨大代价。而EPW-A通过引入PEPI、IRSH和CSPV等增强模块，在保持其鲁棒性和安全性核心优势的同时，显著改善了其在检测成本、访问权限和架构灵活性方面的弱点，使其成为一个更具现实可行性的框架。特别是“对模型演进的约束”这一新颖的评估维度，突显了IRSH协议在解除水印与模型未来适配之间的捆绑关系方面的重要价值。

### 5.2 模型推理优化与水印可检测性之间的内在张力

EPW框架的有效性与MoE模型的推理优化策略之间存在着一种根本性的冲突。为了加速推理并降低内存占用，研究人员开发了多种优化技术，但这些技术往往会直接破坏EPW所依赖的信号。

* **专家剪枝与跳过**：为了在保证性能的同时提升推理速度，一些技术会有选择地剪枝掉不重要的专家，或在推理时动态地跳过某些MoE层的计算 23。这种对专家集合或计算路径的永久性或动态性改变，将彻底破坏EPW所依赖的专家路径的完整性和一致性。
  
* **专家卸载与预取**：像Fate和fMoE这样的系统，通过将不活跃的专家从高成本的GPU内存卸载到CPU内存，来实现在有限资源下部署超大规模MoE模型的目标 24。这些系统依赖于复杂的预测算法来预取下一时刻可能需要的专家。这些预测逻辑本身就可能被攻击者利用来推断路由模式，同时也意味着专家并非总是在GPU上待命，这给需要实时灰盒访问的原始EPW检测带来了新的挑战。
  

这种内在的张力表明，**水印方案的设计不能与其部署的推理服务系统相割裂**。一个真正能在生产环境中长期有效的架构耦合型水印，可能需要与推理引擎进行协同设计，确保优化策略不会无意中抹去用于溯源的关键信号。

### 5.3 可验证EPW与零知识证明（ZKP）的可行性

原始文献中提出的将EPW与零知识证明（ZKP）结合以实现可验证性的设想是富有远见的 1。MoE架构的稀疏激活特性，天然地降低了为模型前向传播生成证明的计算成本，因为证明者只需为被激活的少数专家（如8个中的2个）的计算过程生成证明，这比为同等规模的密集模型生成证明在理论上更具可行性 1。

我们提出的**IRSH协议为ZK-EPW框架注入了新的价值**。在一个增强的ZK-EPW系统中，模型提供商可以生成一个ZKP，向任何第三方证明以下陈述，而无需泄露模型参数或秘密密钥：

> “对于给定的文本T，我的专有模型M（其路由器的初始哈希值为 `router_hash`），所产生的专家激活序列，在与我的秘密密钥 `k` 结合并通过EPW-A检测算法计算后，得到的Z-score大于预设阈值 Zthresh​。”

通过将 `router_hash` 包含在公开声明中，该证明不仅证实了水印的存在，更将其与一个**特定版本**的模型架构绑定。这极大地增强了验证的精确性和强度，防止了模型所有者在模型被篡改后仍声称其拥有有效水印的情况。这为未来结合我们的增强框架与先进密码学验证工具，提供了一条具体的、可操作的研究路径。

* * *

结论：一条通往架构耦合模型问责制的新路径

本报告对专家路径水印（EPW）框架进行了深入的分析、批判性的审视和建设性的增强。原始的EPW框架通过将水印信号与MoE架构的内部路由决策深度耦合，在概念上实现了对传统表层统计水印方法的重大超越。它将水印的本质从一种对模型输出的**表层统计修改**，转变为一种模型的**深层架构属性**，其安全性和鲁棒性根植于复现模型内部复杂计算路径的计算困难性。

然而，我们的分析也揭示了该框架的严重缺陷：其对灰盒访问的依赖限制了其应用场景，其对静态路由的假设使其在面对先进的PEFT攻击时显得脆弱，而高昂的检测成本则阻碍了其大规模部署。

为此，本报告提出并形式化定义了一个增强框架——**EPW-A**。通过引入**概率性专家路径推断（PEPI）**，EPW-A打破了黑盒与灰盒的壁垒，使其能够适用于更广泛的API驱动场景。通过**初始路由器状态哈希（IRSH）**，它将水印与模型架构的版本绑定，有效抵御了针对路由器的微调攻击，并解除了水印对模型未来演进的束缚。通过**置信度分层路径验证（CSPV）**，它在保证检测精度的同时，显著降低了计算开销。

EPW-A的设计体现了一个核心思想：一个真正强大的水印系统，不仅要与模型架构深度融合，还必须能够预见并适应这些架构自身的快速演进。它所引发的关于模型内部状态利用、水印与推理优化协同、以及验证与隐私平衡的思考，为构建更值得信赖、更负责任、更易于问责的大规模AI系统，开辟了一条充满希望的新路径。未来的实证研究将进一步检验和完善这一框架，有望使其成为未来AI安全工具箱中的关键组成部分。